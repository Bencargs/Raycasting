<!DOCTYPE html>
<html>
	<meta name="viewport">
	
	<head>
		<title>Raycasting</title>
	</head>
	
	<body>
		<canvas id="myCanvas"></canvas>
	
		<script>
		
		class Point {
			constructor(x, y) {
				this.x = x;
				this.y = y;
			}
		}
		
		function drawOnImage(image = null) {
		  const canvasElement = document.getElementById("myCanvas");
		  const context = canvasElement.getContext("2d");

		  // if an image is present,
		  // the image passed as a parameter is drawn in the canvas
		  if (image) {
			const imageWidth = image.width;
			const imageHeight = image.height;

			// rescaling the canvas element
			canvasElement.width = imageWidth;
			canvasElement.height = imageHeight;

			context.drawImage(image, 0, 0, imageWidth, imageHeight);
		  }
		}
		
		function fileToDataUri(field) {
		  return new Promise((resolve) => {
			const reader = new FileReader();

			reader.addEventListener("load", () => {
			  resolve(reader.result);
			});

			reader.readAsDataURL(field);
		  });
		}
		
		var viewDistance = 50;
		var fieldOfView = 45;
		var facingAngle = 0;
		var origin = new Point(50, 50);
		
		//var canvas = document.getElementById("myCanvas");
		//var context = canvas.getContext("2d");	
		//var heightmapImage = new Image();
		//heightmapImage.addEventListener(
		//  "load",
		//  () => { 
		//	context.drawImage(heightmapImage, 0, 0);
		//  },
		//  false
		//);
		//heightmapImage.src = 'map3.bmp';
		//
		//
		//var imageData = context.getImageData(0, 0, canvas.width, canvas.height);
		//const pixel = imageData.data;
        //let rgbArray = []
		//const r=0, g=1, b=2,a=3;
		//for (var p = 0; p<pixel.length; p+=4)
        //{
		//	pixel[p+r] = 127;
		//	pixel[p+g] = 127;
		//	pixel[p+b] = 127;
        //}
		//context.putImageData(imageData,0,0);
		
		//const image = document.createElement("img");
		//'image.src = await fileToDataUri('map3.bmp');
		//drawOnImage(image);
		
		const img = new Image();
		img.crossOrigin = "anonymous";
		img.src = "./resources/map3.bmp";
		const canvas = document.getElementById("myCanvas");
		const ctx = canvas.getContext("2d");
		img.addEventListener("load", () => {
		  ctx.drawImage(img, 0, 0);
		  img.style.display = "none";
		});

		function pick(event, destination) {
		  const bounding = canvas.getBoundingClientRect();
		  const x = event.clientX - bounding.left;
		  const y = event.clientY - bounding.top;
		  const pixel = ctx.getImageData(x, y, 1, 1);
		  const data = pixel.data;

		  const rgba = `rgba(${data[0]}, ${data[1]}, ${data[2]}, ${data[3] / 255})`;
		  destination.style.background = rgba;
		  destination.textContent = rgba;

		  return rgba;
		}

		canvas.addEventListener("mousemove", (event) => 
		{
			let asdsa  = 42;
			pick(event, 42);
		});
//canvas.addEventListener("click", (event) => pick(event, selectedColor));
		
		
		
		//var test = context.getImageData(0, 0, 100, 100);
		//context.fillStyle = `rgba(${127}, ${127}, ${127}, ${127})`;
		//context.fillRect(0, 0, 50, 50);
		//context.putImageData(context, test, 50, 50);
		
		
		//var heightmap = context.getImageData(0, 0, 100, 100);
		//for (var x = 0; x < 100; x++) {
		//	for (var y = 0; y < 100; y++) {
		//		let k= GetPixel(heightmap, x, y);
		//		if (k != 0)
		//			console.log(k);
		//	}
		//}
		
		</script> 
	</body>
</html>